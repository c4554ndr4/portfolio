---
import BaseLayout from '../layouts/BaseLayout.astro';
import { featuredLinks, otherLinks } from '../data/links';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;
const writeups = (await getCollection('writeups', ({ data }) => data.status === 'published')).sort(
	(a, b) => (b.data.date?.valueOf() ?? 0) - (a.data.date?.valueOf() ?? 0),
);

const externalLinks = [
	{
		title: 'Writeups',
		href: `${base}writeups/`,
	},
	{
		title: 'The Symbiont Alignment Thesis',
		href: 'https://future.forum',
	},
	...featuredLinks,
	...otherLinks,
];

const formatDate = (date) =>
	new Intl.DateTimeFormat('en-US', {
		month: 'short',
		day: 'numeric',
		year: 'numeric',
	}).format(date);
---

<BaseLayout>
	<section class="hero">
		<div>
			<h1 class="hero__title">Cassandra</h1>
			<p class="hero__subtitle">Links and writeups.</p>
		</div>
	</section>

	<section class="section">
		<h2 class="section__title">Writeups</h2>
		<ul class="link-list">
			{writeups.length ? (
				writeups.map((entry) => (
					<li class="link-list__item">
						<a class="link-list__title" href={`${base}writeups/${entry.slug}/`}>
							{entry.data.title}
						</a>
						{entry.data.date ? (
							<span class="link-list__meta">{formatDate(entry.data.date)}</span>
						) : null}
					</li>
				))
			) : (
				<li class="link-list__item">
					<span class="link-list__title">No writeups yet.</span>
				</li>
			)}
		</ul>
	</section>

	<section class="section">
		<h2 class="section__title">Links</h2>
		<ul class="link-list">
			{externalLinks.map((link) => (
				<li class="link-list__item">
					<a class="link-list__title" href={link.href} target="_blank" rel="noreferrer">
						{link.title}
					</a>
				</li>
			))}
		</ul>
	</section>

	<style>
		.link-list {
			list-style: none;
			margin: 0;
			padding: 0;
			display: grid;
			gap: 12px;
		}

		.link-list__item {
			display: flex;
			align-items: baseline;
			justify-content: space-between;
			gap: 16px;
			padding: 10px 12px;
			border: 1px solid rgba(41, 255, 143, 0.15);
			border-radius: 10px;
			background: rgba(6, 18, 13, 0.7);
		}

		.link-list__title {
			font-size: 1rem;
			letter-spacing: 0.02em;
		}

		.link-list__meta {
			font-size: 0.85rem;
			color: var(--ink-soft);
			white-space: nowrap;
		}

		@media (max-width: 600px) {
			.link-list__item {
				flex-direction: column;
				align-items: flex-start;
			}
		}
	</style>
</BaseLayout>
