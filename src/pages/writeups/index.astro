---
import BaseLayout from '../../layouts/BaseLayout.astro';
import WriteupCard from '../../components/WriteupCard.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;
const writeups = (await getCollection('writeups', ({ data }) => data.status === 'published')).sort(
	(a, b) => (b.data.date?.valueOf() ?? 0) - (a.data.date?.valueOf() ?? 0),
);

const formatDate = (date) =>
	new Intl.DateTimeFormat('en-US', {
		month: 'short',
		day: 'numeric',
		year: 'numeric',
	}).format(date);
---

<BaseLayout title="Writeups" description="Markdown writeups collected in the repository.">
	<section class="hero">
		<div>
			<h1 class="hero__title">Writeups</h1>
			<p class="hero__subtitle">
				Markdown posts, field notes, and build logs. Each entry lives in
				<code>src/content/writeups</code>.
			</p>
		</div>
	</section>

	<section class="section">
		<h2 class="section__title">All Posts</h2>
		<div class="card-grid">
			{writeups.length ? (
				writeups.map((entry, index) => (
					<WriteupCard
						href={`${base}writeups/${entry.slug}/`}
						title={entry.data.title}
						description={entry.data.description}
						date={entry.data.date ? formatDate(entry.data.date) : null}
						style={`--delay: ${0.05 + index * 0.06}s;`}
					/>
				))
			) : (
				<div class="card" style="--delay: 0.1s;">
					<span class="tag">Writeups</span>
					<h3 class="card__title">No writeups yet</h3>
					<p class="card__meta">Add a markdown file to the writeups folder to publish.</p>
				</div>
			)}
		</div>
	</section>
</BaseLayout>
